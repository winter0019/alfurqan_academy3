{% extends 'layout.html' %}
{% block content %}
<div class="max-w-lg mx-auto bg-white p-6 rounded shadow">
  <h2 class="text-xl font-bold mb-4">Record Payment</h2>
  <form method="POST">
    
    <!-- Student Search -->
    <input type="text" id="student-search" placeholder="Search student by name or reg number"
           class="w-full border p-2 mb-3 rounded">

    <ul id="search-results" class="border rounded mb-3 hidden"></ul>

    <input type="hidden" name="student_id" id="student_id">

    <input type="number" step="0.01" name="amount_paid" placeholder="Amount Paid"
           class="w-full border p-2 mb-3 rounded">
    <input type="text" name="payment_type" placeholder="Payment Type"
           class="w-full border p-2 mb-3 rounded">

    <select name="term" class="w-full border p-2 mb-3 rounded">
      <option>1st Term</option>
      <option>2nd Term</option>
      <option>3rd Term</option>
    </select>

    <input type="text" name="session" placeholder="Session (e.g. 2024/2025)"
           class="w-full border p-2 mb-3 rounded">

    <button type="submit" class="w-full bg-green-600 text-white py-2 rounded">Save Payment</button>
  </form>
</div>

<script>
const searchInput = document.getElementById("student-search");
const resultsList = document.getElementById("search-results");
const hiddenId = document.getElementById("student_id");

searchInput.addEventListener("input", async function() {
  const q = this.value;
  if (q.length < 2) {
    resultsList.innerHTML = "";
    resultsList.classList.add("hidden");
    return;
  }

  const res = await fetch(`/search-students?q=${q}`);
  const data = await res.json();

  resultsList.innerHTML = "";
  if (data.students.length > 0) {
    resultsList.classList.remove("hidden");
    data.students.forEach(s => {
      const li = document.createElement("li");
      li.textContent = `${s.name} (${s.reg_number})`;
      li.className = "p-2 hover:bg-gray-100 cursor-pointer";
      li.onclick = () => {
        searchInput.value = `${s.name} (${s.reg_number})`;
        hiddenId.value = s.id;
        resultsList.classList.add("hidden");
      };
      resultsList.appendChild(li);
    });
  } else {
    resultsList.classList.add("hidden");
  }
});
</script>
{% endblock %}
